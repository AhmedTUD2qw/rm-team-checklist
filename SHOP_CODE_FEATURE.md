# ميزة كود المتجر - Shop Code Feature

## 🎯 الهدف
إضافة نظام كود المتجر (Shop Code) للفروع لتسهيل التعرف على الفروع وتنظيم البيانات بشكل أفضل.

## ✨ الميزات المضافة

### 🏪 كود المتجر للفروع
- **إضافة كود فريد لكل فرع**: كل فرع له كود مميز
- **البحث بالاسم أو الكود**: يمكن البحث عن الفرع بالاسم أو الكود
- **ملء تلقائي**: عند اختيار فرع يتم ملء الكود تلقائياً
- **عرض في البيانات**: الكود يظهر في جميع التقارير والجداول

### 🔍 البحث الذكي
- **بحث مزدوج**: البحث في اسم الفرع وكود المتجر معاً
- **اقتراحات محسنة**: عرض الاسم والكود في الاقتراحات
- **بحث عكسي**: إدخال الكود يجلب اسم الفرع تلقائياً

### 📊 عرض البيانات
- **في لوحة الإدارة**: عمود منفصل لكود المتجر
- **في تصدير Excel**: الكود يظهر في الملف المصدر
- **في النماذج**: حقل منفصل لكود المتجر

## 🏗️ الهيكل التقني

### 📊 قاعدة البيانات المحدثة
```sql
-- تحديث جدول الفروع
ALTER TABLE branches ADD COLUMN shop_code TEXT;

-- تحديث جدول البيانات
ALTER TABLE data_entries ADD COLUMN shop_code TEXT;

-- إضافة قيود الفرادة
CREATE UNIQUE INDEX idx_branch_shop_code 
ON branches(shop_code, employee_code);
```

### 🔗 Routes الجديدة
```python
GET /get_branches              # البحث بالاسم والكود
GET /get_branch_by_code       # البحث بالكود فقط
POST /submit_data             # حفظ مع كود المتجر
```

### 📁 الملفات المحدثة
- `app.py` - Routes وقاعدة البيانات
- `templates/data_entry.html` - واجهة إدخال البيانات
- `templates/admin_dashboard.html` - عرض البيانات
- `static/js/data_entry.js` - JavaScript للبحث الذكي
- `static/css/style.css` - تصميم النماذج

### 🛠️ ملفات الصيانة
- `update_database.py` - تحديث قاعدة البيانات
- `test_shop_code.py` - اختبارات شاملة

## 🎨 واجهة المستخدم

### 📝 نموذج إدخال البيانات
```html
<div class="form-row">
    <div class="form-group">
        <label>Branch Name:</label>
        <input type="text" placeholder="Type branch name or shop code...">
        <div class="autocomplete-suggestions">
            <!-- اقتراحات ذكية -->
        </div>
    </div>
    
    <div class="form-group">
        <label>Shop Code:</label>
        <input type="text" placeholder="Enter shop code...">
    </div>
</div>
```

### 🔍 اقتراحات محسنة
- عرض اسم الفرع بخط عريض
- عرض كود المتجر بخط صغير
- إمكانية النقر للاختيار
- تمييز النتائج المطابقة

### 📊 عرض في الجداول
| Branch | Shop Code | Model | ... |
|--------|-----------|-------|-----|
| Samsung Store Cairo | SSC001 | OLED - S95F | ... |
| Samsung Mall Alexandria | SMA002 | Neo QLED - QN90 | ... |

## 🔄 سير العمل

### ➕ إضافة فرع جديد
1. الموظف يكتب اسم الفرع الجديد
2. يدخل كود المتجر الفريد
3. النظام يحفظ الفرع مع الكود
4. الفرع يصبح متاحاً للاستخدام المستقبلي

### 🔍 البحث عن فرع موجود
1. الموظف يبدأ الكتابة (اسم أو كود)
2. النظام يعرض الاقتراحات المطابقة
3. الموظف يختار الفرع المناسب
4. الاسم والكود يتم ملؤهما تلقائياً

### 📊 عرض البيانات
1. الإداري يفتح لوحة التحكم
2. يرى جدول البيانات مع أكواد المتاجر
3. يمكن الفلترة والبحث بالكود
4. التصدير يشمل أكواد المتاجر

## 🧪 الاختبارات

### ✅ اختبارات مكتملة
- إضافة فروع مع أكواد
- البحث بالاسم والكود
- التحقق من الفرادة
- حفظ البيانات مع الأكواد
- تحديث قاعدة البيانات

### 📊 نتائج الاختبارات
```
🏪 Testing Shop Code functionality...
✅ Added branch: Samsung Store Cairo (Code: SSC001)
✅ Added branch: Samsung Mall Alexandria (Code: SMA002)
✅ Added branch: Samsung Outlet Giza (Code: SOG003)

🔍 Testing branch search by name:
  Search 'Samsung': Found 3 branches
  Search 'Cairo': Found 1 branches
  Search 'Mall': Found 2 branches

🏷️ Testing branch search by shop code:
  Search code 'SSC001': Found 1 branches
  Search code 'SMA': Found 1 branches
  Search code '003': Found 2 branches

✅ Data entry with shop code saved successfully
✅ Latest entry: Samsung Store Cairo (Code: SSC001) - OLED - S95F
```

## 📋 كيفية الاستخدام

### 🚀 للموظفين
1. **إدخال فرع جديد**:
   - اكتب اسم الفرع في حقل "Branch Name"
   - اكتب كود المتجر في حقل "Shop Code"
   - أكمل باقي البيانات واحفظ

2. **اختيار فرع موجود**:
   - ابدأ الكتابة في حقل "Branch Name"
   - اختر من الاقتراحات المعروضة
   - الكود سيتم ملؤه تلقائياً

3. **البحث بالكود**:
   - اكتب الكود في حقل "Shop Code"
   - اسم الفرع سيظهر تلقائياً

### 👨‍💼 للإداريين
1. **عرض البيانات**:
   - افتح لوحة الإدارة
   - ستجد عمود "Shop Code" في الجدول
   - يمكن الفلترة والبحث بالكود

2. **تصدير البيانات**:
   - اضغط "Export to Excel"
   - الملف سيحتوي على أكواد المتاجر
   - يمكن استخدام الأكواد للتحليل

## 🎯 الفوائد

### 👨‍💼 للإداريين
- **تنظيم أفضل**: تصنيف الفروع بأكواد واضحة
- **تحليل سهل**: استخدام الأكواد في التقارير
- **تتبع دقيق**: معرفة أداء كل فرع بالكود
- **إدارة محسنة**: سهولة التعرف على الفروع

### 👨‍💻 للموظفين
- **إدخال أسرع**: البحث بالكود أسرع من الاسم
- **دقة أعلى**: تجنب الأخطاء في أسماء الفروع
- **سهولة الاستخدام**: واجهة بديهية ومرنة
- **توفير الوقت**: ملء تلقائي للبيانات

### 🏢 للشركة
- **معايير موحدة**: نظام ترقيم موحد للفروع
- **تقارير دقيقة**: بيانات منظمة وقابلة للتحليل
- **كفاءة عالية**: تقليل الأخطاء والوقت المهدر
- **قابلية التوسع**: سهولة إضافة فروع جديدة

## 🔮 التطوير المستقبلي

### 📈 ميزات مقترحة
- **تصنيف الأكواد**: مجموعات حسب المنطقة أو النوع
- **تقارير متقدمة**: تحليل الأداء حسب الكود
- **خرائط الفروع**: ربط الأكواد بالمواقع الجغرافية
- **إحصائيات الفروع**: مقارنة الأداء بين الفروع

### 🛠️ تحسينات تقنية
- **API للأكواد**: واجهة برمجية للتكامل الخارجي
- **تحقق متقدم**: قواعد تحقق معقدة للأكواد
- **نسخ احتياطية**: حفظ واستعادة أكواد الفروع
- **مزامنة**: مزامنة الأكواد مع أنظمة أخرى

## 🔧 الصيانة والتحديث

### 📊 تحديث قاعدة البيانات
```bash
# تشغيل تحديث قاعدة البيانات
python update_database.py

# اختبار الميزة الجديدة
python test_shop_code.py

# تشغيل النظام
python app.py
```

### 🔍 استكشاف الأخطاء
- **الكود لا يظهر**: تأكد من تحديث قاعدة البيانات
- **البحث لا يعمل**: تحقق من JavaScript في المتصفح
- **البيانات مفقودة**: راجع ملف النسخ الاحتياطية

---
**تاريخ الإنشاء**: 21 أكتوبر 2025  
**الحالة**: مكتمل ✅  
**المطور**: Kiro AI Assistant